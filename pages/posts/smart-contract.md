---
draft: true 
title: 憧憬成为 web3 高手之：智能合约
date: 2024-07-16
updated: 2024-07-16
categories: Web3相关
tags:
    - web3
    - solidity
---

# 智能合约

最初由密码学家 Nick Szabo 提出，web3 语境下指代在 Ethereum 虚拟机环境中运行的不可变的计算机程序。

## 智能合约的生命周期

智能合约通常以高级语言编写，例如Solidity，随后被编译为 EVM 中运行的低级字节码。编译完成后会随着合约创建交易被部署至区块链中。每个合约都由随机生成的以太坊地址标识，该地址在交易中作为接收者，可以将资金发送给合约或者调用合约的某个功能。

合约 __只有__ 在被交易调用时才会运行，以太坊的所有智能合约均由 EOA 发起的交易执行。合约可以调用另一个合约，但是这种执行链的第一个合约永远是由 EOA 发起的交易执行。合约永远不会自动执行或者在后台运行，在被交易触发执行，直接或间接作为执行链的一环之前，合约在区块链上实际上是“休眠”的。

交易是 _原子性 atomic_ 的，交易完全执行，只在交易成功中止时记录全局状态（合约，账户等）的任何更改。如果交易由于错误而失败，则所有的效果（状态变化）将会回滚，就好像交易从未执行一样。失败的交易仍然存储在区块链中，并从原始账户扣除 gas 成本，但对合约或者账户没有其他影响。

合约的代码不能更改，然而合约可以被“删除”，从区块链上删除代码和它的内部状态（变量）。要删除合约，需要执行被称为 _SELFDESTRUCT_ （曾被称为 _SUICIDE_ ）的 EVM 操作码。
该操作码将区块链中的合约移除，该操作花费“负的 gas ”，从而激励储存状态的释放。该操作不会删除过去的交易记录，但是确实会从所有未来的区块中移除合约状态。